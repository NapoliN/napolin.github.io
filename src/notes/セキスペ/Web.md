---
title: セキスペ入門 Web
tags:
 - セキスペ
date: 2025/10/20
---

# Web

## WSDL
Web Services Description Language。W3C勧告。
Webサービスのインターフェースを記述するためのXMLベースの言語。
WSDLを記述することで、クライアントはWebサービスの実装の詳細を知らなくても、サービスを利用できる。

## ヘッダ
### X-Content-Type-Options
MIMEタイプのスニッフィングを防止するためのヘッダ。
`X-Content-Type-Options: nosniff` を指定することで、ブラウザがレスポンスのContent-Typeヘッダを尊重し、MIMEタイプのスニッフィングを行わなくなる。
(スニッフィング=レスポンスの内容からMIMEタイプ、つまりHTMLやJSであるかを推測すること)

### Content-Security-Policy
コンテンツの読み込み先を制限するためのヘッダ。
`Conten-Security-Policy: default-src 'self';` のように指定することで、同一オリジンからのコンテンツ読み込みのみを許可できる。

### Strict-Transport-Security
HSTSとも。
HTTPでアクセスしてきたユーザに対して、以降のアクセスを自動的にHTTPSに変換するよう(ブラウザに対して)要請する仕組み。
HTTPSで通信するべきサイトに対して、HTTPでアクセスしてきたとき、301Redirectを返すのが実装ができる。
この実装の場合、リダイレクトする前は毎回HTTP通信を行うことになり、中間者攻撃に対して脆弱になる。
ブラウザに対してあらかじめHTTPSで通信するように要求することで、この最初の1回をなくすことができる。


## cookie設定
### Secure
Secure属性が設定されたクッキーは、HTTPS通信でのみ送信される。
HTTP通信を傍受できる中間者への流出を防止することができる。

### HttpOnly
HttpOnly属性が設定されたクッキーは、JavaScriptから参照できない。
XSS攻撃による流出を防止することができる。

### SameSite
クッキーにSameSite属性を付与したとき、クロスサイトリクエストに対してそのCookieを送信するか制御できる。
CSRF攻撃の防止に有効。
- Strict
    クロスサイトリクエストに対して、そのCookieを送信しない。
- Lax
    クロスサイトリクエストに対して、そのCookieを送信しない。ただし、安全なメソッド(GET, HEAD, OPTIONS, TRACE)でのナビゲーションに対しては送信する。
    iframe、画像、スクリプトなどのリソース読み込みに対しては送信しない。
― None
    クロスサイトリクエストに対しても、そのCookieを送信する。
    CSRF攻撃を防止できない。Secure属性を付与する必要がある。

## トランザクション署名
マルウェアの影響が及ばないハードウェアトークンによるワンタイムパスワードを用いて、オンラインバンキングの取引内容を認証する仕組み。
振込情報に対する署名を行いWebサーバに送信することで、MITB攻撃を防止できる。

## 攻撃手法
### HTTPヘッダインジェクション

### CSRF
Cross Site Request Forgery.

### XSS
Cross Site Scripting.CWE-79.
悪意のあるスクリプトをWebページに挿入し、閲覧者のブラウザ上で実行させる攻撃。
このような攻撃が可能なWebサイトをXSS脆弱性があるという。
#### 攻撃の種類
##### 格納型
攻撃コードを対象のサーバ(DBなど)に保存させる方法。
閲覧者がその情報を読み込んだときに、自動的に攻撃コードが実行される。
ex. 掲示板に `<script>...</script>` を書き込む。

##### 反射型
スクリプトをURLなどに含め、閲覧者がそのURLにアクセスしたときに攻撃コードを実行させる方法。
ex. メールに悪意のあるURLを記載し、閲覧者がクリックする。

##### DOMベース
フロントエンド側で動作するjavascriptが、innnerHTMLなどを用いて不適切にDOMを操作することで、攻撃コードを実行させる方法。

#### 対策
##### エスケープ処理
特殊文字(<, >, &, ', ")をHTMLエンティティ(&lt;, &gt;, &amp;, &apos;, &quot;)に変換する。

##### URL出力のホワイトリスト化
リンクを動的に生成するwebアプリにおいて、リンク先を「http://」「https://」で始まるURLに固定する。
(javascript: などのスキームを排除する)

##### scriptタグを動的に生成しない
スクリプトタグの動的生成は、意図しないスクリプトを埋め込まれるリスクがあるため、避ける。

##### スタイルシートの任意取り込みを防止
css内ではスクリプトを描くことができるので、任意サイトのcssを読み込める状態にすると、生成するwebアプリでそのcssを読みこませ、スクリプトを実行されるリスクがある。


### セッションハイジャック

## MITB
Man In The Browser攻撃。
ユーザPC内でプロキシとして動作し、WebブラウザとWebサーバ間の通信を盗聴・改ざんする攻撃。
クライアント内で動作するため、Webサーバ側で不正検知が難しい。
トランザクション署名などで対策する。


### クリックジャッキング
Webページ上に透明なiframeを重ねて表示し、ユーザが意図しない操作を行わせる攻撃。
攻撃対象のwebページをiframeで読み込み、透明化して重ねる。
#### 対策
##### X-Frame-Options
X-Frame-Optionsヘッダを指定することで、webサイトをiframeで読み込むことを禁止する。
- DENY
  どのサイトからもiframeで読み込むことを禁止する。
- SAMEORIGIN
    同一オリジンからのiframeでの読み込みを許可する。
- ALLOW-FROM uri
    指定したオリジンからのiframeでの読み込みを許可する

##### パスワード認証
重要な処理の実行前にパスワード認証を行うことで、意図しない操作を防止する。


## CDN
Content Delivery Network.
地理的に分散したサーバ群を用いて、コンテンツを配信する仕組み。
ユーザに近いサーバからコンテンツを配信することで、応答速度の向上、サーバ負荷の軽減を実現することができる。
Ex. CloudFront, Cloudflare

### CDNサービスをもちいたコンテンツ配信
1. ユーザがWebサイト(www.example.com)にアクセス
2. DNSリゾルバが(www.example.com)のIPアドレスを問い合わせ
3. example.comのDNSサーバが、CDNのCNAMEを返す(www.example.com.cdn-provider.com)
4. CDNのDNSサーバが、ユーザに近いCDNエッジサーバのIPアドレスを返す
5. ユーザは応答されたIPアドレスを基に、CDNエッジサーバにHTTPリクエストを送信する
6. CDNエッジサーバは、HTTPリクエストのHostヘッダを基に、キャッシュされたコンテンツを返す (キャッシュミスの場合、オリジンサーバに問い合わせる)
7. ユーザはコンテンツを受け取る

::: info
サーバ証明書のSANには接続先Webサイトのドメインを記述する。
上記のCDNはDNS名前解決上の接続先の話なので、HTTPレイヤーではwww.example.comにアクセスしているという扱いになる。
つまり、エッジサーバがwww.example.comの証明書を提供する状態になる。
(その証明書を誰が発行するか、はCDNサービスによる。CDN側で自動発行するケースが多いらしい？)
:::

### CDNを利用するメリット
- 応答速度の向上
- サーバ負荷の軽減
- DDoS攻撃の緩和(CDNが攻撃トラフィックを吸収する)
etc...


#### ドメインフロンティング攻撃
TLSのSNIとHTTPのHostヘッダに異なるドメインを指定することで、ファイアウォールによる通信遮断を回避しつつ、CDNを経由して悪意のあるサーバに接続させる攻撃。
##### 攻撃の仕組み
HTTPS通信では、クライアントはハンドシェイク(ClientHello)の中でSNI(Server Name Indication)拡張を用いて、接続先のドメイン名をサーバに伝える。
サーバ(CDNエッジサーバ)は、SNIに基づいて適切なサーバ証明書を返す。
TLSコネクションの確立後、暗号化されたHTTPリクエストが送信される。
CDNエッジサーバは、HTTPリクエストのHostヘッダを基に、オリジンサーバにリクエストを転送する。

ここで、攻撃者が何らかの方法によって、クライアントのHostヘッダを、自身の管理する悪意のあるサーバのドメインに書き換えさせることができたとする。
この状態で、クライアントがCDNエッジサーバに接続すると、SNIには正規のドメインが指定されているため、ファイアウォールによるURLフィルタリングを回避できてしまう。

::: info
SSL復号型のファイアウォールの場合、HTTPSリクエストを復号してHostヘッダを確認できるため、ドメインフロンティング攻撃を防止できる。
:::