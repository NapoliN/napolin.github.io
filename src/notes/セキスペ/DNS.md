---
title: セキスペ入門 DNS
tags: 
    - セキスペ
date: 2025/10/20
---

# DNSセキュリティ
DNSの基礎知識については別途記事を書く予定。

DNS(Domain Name System)は、ホスト名とIPアドレスの対応付けを行うデータベースのような機能を提供する分散型システムです。
各ドメインに対してゾーンと呼ばれる管理単位が割り当てられ、ゾーンを管理する権利DNSサーバがそのドメインに対する名前解決を担当します。
ホスト名を用いてアクセスするクライアントは、DNS解決を行いて対応するIPアドレスを取得し、そのIPアドレスに対して通信を行います。
そのため、DNSの応答が改ざんされたり、偽の応答が返されたりすると、クライアントは誤ったIPアドレスにアクセスしてしまい、サービス妨害や情報漏洩などの被害が発生する可能性があります。

代表的な攻撃手法の紹介を行った後、それらの問題を解決するための技術について説明します。

## 攻撃手法
### DNS amp攻撃 (DNS Reflection攻撃とも)
DNSサーバのオープンリゾルバ機能を悪用し、攻撃対象に大量のDNS応答を送り付けるDDoS攻撃。

::: info
UDPで行う通信の中で、クエリに対してリプライのパケットサイズが大きいプロトコルであれば成立するので、NTPやSSDPなども同様の攻撃に利用される。
:::

### DNSキャッシュポイズニング
DNSのキャッシュに不正な情報を注入し、正しい名前解決を妨害する攻撃。

### カミンスキー攻撃
DNSキャッシュポイズニングの一種。
1. 攻撃者がキャッシュDNSに存在しないサブドメインに対するDNSクエリを大量に送り付ける
2. キャッシュDNSはすべてのクエリに対して、再帰問い合わせを行う
3. 攻撃者は正規のDNSが応答する前に、攻撃者が用意した応答を返す
4. キャッシュDNSは誤った応答をキャッシュしてしまう
ソースポートのランダム化によって攻撃の成功率を下げることができる。
また、DNSSECによって応答を認証することで攻撃を無効化できる。





## リソースレコード
ゾーンファイルに記述される、DNSのデータの単位。

色んなレコードタイプがある。

| レコードタイプ | 説明 |
| -------------- | ---- |
| A              | ホスト名からIPv4アドレスを引く |
| AAAA           | ホスト名からIPv6アドレスを引く |
| CNAME          | ホスト名の別名を定義する (Canonical Name) |
| MX             | メールサーバのホスト名を指定する (Mail eXchanger) |
| NS             | そのゾーンを管理するDNSサーバのホスト名を指定する (Name Server) |

::: info
**CAAレコード**

Certification Authority Authorization。
登録されたドメインに対応する証明書の発行を許可する認証局を指定するレコード。
ドメイン所有者でない第三者が勝手にそのドメインのサーバ証明書を発行することを防ぐことができる。
認証局はサーバ証明書の発行前にDNSに問い合わせ、ドメイン所有者が当該CAからの証明書発行を許可しているかチェックする。
サーバ証明書/ワイルドカード証明書を発行可能なCAのドメイン、無効リクエストの報告先メアドを指定できる。
:::

## DNSSEC
DNS Security Extensions.
DNS権威サーバの応答にデジタル署名を付与し、応答の改ざん検知と応答元の認証を行う仕組み。
1. リゾルバがDNSクエリを送信
2. 権威サーバが応答にデジタル署名を付与して返す
3. リゾルバは、応答に付与された署名を検証する

PKI同様、ルートからの信頼の連鎖(chain of trust)を利用する。
リゾルバはルートゾーンの公開鍵をトラストアンカーとして保持するため、そこから始まる信頼の連鎖をたどって応答の正当性を検証できる。

## DoT
DNS over TLS.
TCP 853番ポートでTLSセッションを確立し、その上でDNSクエリ/応答をやり取りする仕組み。

## DoH
DNS over HTTPS.
HTTPSセッション上でDNSクエリ/応答をやり取りする仕組み。


